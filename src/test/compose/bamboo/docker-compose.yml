# docker-compose --project-name bamboo

webserver:
  domainname: example.com
  hostname: bamboo
  image: nginx:1.9
  links:
    - appserver:appserver
  ports:
    - 80:80
    - 443:443
  volumes:
    - ./nginx.conf:/etc/nginx/conf.d/default.conf
# run ../scripts/mk-self-signed-cert.sh to create a self-signed cert for bamboo.example.com
    - ./server.key:/etc/ssl/private/server.key
    - ./server.crt:/etc/ssl/private/server.crt

# This will fail initially. After configuring the server with a license and clicking
# "Enable Remote Agent Support" run `docker-compose start appagent`. On my slow, tiny
# virtualbox docker host this registered itself within about a minute.
appagent:
  command: agent
  image: dweomer/atlassian-bamboo:5.9.3
  links:
    - appserver:bamboo
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock


appserver:
  command: server
  environment:
    BAMBOO_CONNECTOR_PROXY_NAME: bamboo.example.com
  hostname: bamboo
  image: dweomer/atlassian-bamboo:5.9.3
  links:
    - database:database
#  extra_hosts:
#    - api.hipchat.com:1.2.3.4
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock


database:
  image: postgres:9.4
  environment:
    POSTGRES_USER: bamboo
    POSTGRES_PASSWORD: bamboo
